<!--
  WIXSCROLL PASSTHROUGH HANDLER
  Copy and paste this ENTIRE code into your Wix Custom Code section
  Settings > Custom Code > Add Custom Code > Place in "Body - End"
-->

<script>
(function() {
  'use strict';

  // Batching for smoother scroll (single scrollBy per frame)
  var pendingY = 0;
  var pendingX = 0;
  var rafId = null;

  function flushScroll() {
    rafId = null;
    if (pendingY === 0 && pendingX === 0) return;
    try {
      window.scrollBy({ top: pendingY, left: pendingX, behavior: 'auto' });
    } catch (e) {
      window.scrollBy(pendingY, pendingX);
    }
    pendingY = 0;
    pendingX = 0;
  }

  window.addEventListener('message', function(event) {
    var data = event.data;
    if (!data) return;

    // Scroll payload from child iframe
    if (data.type === 'scroll') {
      var deltaY = Number(data.deltaY) || 0;
      var deltaX = Number(data.deltaX) || 0;
      if (deltaY !== 0 || deltaX !== 0) {
        pendingY += deltaY;
        pendingX += deltaX;
        if (rafId === null) {
          var raf = window.requestAnimationFrame || function(cb) { return setTimeout(cb, 16); };
          rafId = raf(flushScroll);
        }
      }
    }

    // Handshake ACK back to iframe
    if (data.type === 'scroll-bridge-ping' && event.source) {
      try {
        event.source.postMessage({ type: 'scroll-bridge-ack' }, '*');
      } catch (_) {
        // Ignore cross-origin issues
      }
    }
  }, false);
})();
</script>
