<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        /* CRITICAL: Prevent ALL scrollbars - parent Wix page handles scrolling */
        html, body {
            width: 100%;
            min-height: 100%;
            height: auto;
            background: transparent;
            margin: 0;
            padding: 0;
            overflow: hidden !important;
            overflow-x: hidden !important;
            overflow-y: hidden !important;
            /* Hide scrollbars in all browsers */
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        html::-webkit-scrollbar,
        body::-webkit-scrollbar {
            display: none !important;
            width: 0 !important;
            height: 0 !important;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        iframe {
            width: 100%;
            min-height: 100vh;
            border: none;
            display: block;
            background: transparent;
            /* CRITICAL: No scrollbars on iframe - content expands iframe height */
            overflow: hidden !important;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        iframe::-webkit-scrollbar {
            display: none !important;
            width: 0 !important;
            height: 0 !important;
        }
    </style>
</head>
<body>
    <!--
      IMPORTANT: Replace "YOUR-HOSTED-URL" with the actual URL where you
      uploaded your index.html file. Examples:

      - GitHub Pages: https://yourusername.github.io/catalystmagazineposts/
      - Netlify: https://yoursite.netlify.app/
      - Custom Domain: https://yourdomain.com/magazine/
      - Wix File Manager: https://yoursite.wixsite.com/files/index.html
    -->
    <iframe
        src="https://sillybob123.github.io/catalystmagazineposts/index.html"
        id="magazine-embed"
        title="Catalyst Magazine"
        loading="eager"
        scrolling="no"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
        sandbox="allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox allow-forms allow-top-navigation"
    ></iframe>

    <script>
        (function() {
            const iframe = document.getElementById('magazine-embed');
            let lastHeight = 1200; // safe fallback for zoomed-in users

            // Detect browser zoom to add appropriate buffer
            const getZoomFactor = () => {
                const vpScale = window.visualViewport?.scale || 1;
                const widthRatio = window.outerWidth && window.innerWidth ? (window.outerWidth / window.innerWidth) : 1;
                return Math.max(1, vpScale, widthRatio > 0.5 ? widthRatio : 1);
            };

            const applyHeight = (rawHeight) => {
                if (!iframe) return;
                const parsed = Math.ceil(Number(rawHeight) || 0);

                // Add extra buffer based on zoom level - be VERY generous
                const zoom = getZoomFactor();
                const zoomBuffer = Math.ceil((zoom - 1) * 150);
                // Add 100px base buffer + zoom buffer
                const next = Math.max(parsed + 100 + zoomBuffer, 1200);

                if (Math.abs(next - lastHeight) < 5) return;
                lastHeight = next;
                iframe.style.height = `${next}px`;
                iframe.style.minHeight = `${next}px`;

                // Bubble the height up to the host page (Wix listens for postMessages)
                try {
                    if (window.parent && window.parent !== window) {
                        window.parent.postMessage({ type: 'setHeight', height: next }, '*');
                        window.parent.postMessage({ type: 'embed-size', height: next }, '*');
                    }
                } catch (err) {
                    console.warn('Unable to propagate height to parent', err);
                }
            };

            // Auto-resize iframe to match content height
            window.addEventListener('message', function(event) {
                const data = event.data || {};
                if (!data || typeof data !== 'object') return;
                if (data.type === 'setHeight' || data.type === 'embed-size') {
                    applyHeight(data.height);
                }
            }, false);

            // Ensure iframe loads properly and has a generous minimum height
            document.addEventListener('DOMContentLoaded', function() {
                if (iframe) {
                    iframe.style.minHeight = `${lastHeight}px`;
                    // Ensure scrolling is disabled
                    iframe.setAttribute('scrolling', 'no');
                    iframe.style.overflow = 'hidden';

                    iframe.addEventListener('load', function() {
                        applyHeight(lastHeight);
                        console.log('Catalyst Magazine loaded successfully');
                    });
                }
            });

            // Listen for resize and zoom changes
            window.addEventListener('resize', () => {
                // Force recalculation on resize (may indicate zoom change)
                applyHeight(lastHeight);
            });

            // VisualViewport API for zoom detection
            if (window.visualViewport) {
                window.visualViewport.addEventListener('resize', () => {
                    applyHeight(lastHeight);
                }, { passive: true });
            }
        })();
    </script>
</body>
</html>
